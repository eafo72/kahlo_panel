<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Museo Casa Kahlo | Información de Visita</title>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Bootstrap Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

  <!-- Flatpickr CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
  <!-- Usa el tema rojo -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/themes/material_red.css">

  <!-- Google Fonts -->
  <link
    href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&family=Oswald:wght@400;500&display=swap"
    rel="stylesheet">

  <!-- AOS -->
  <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">

  <!-- axios for API calls -->
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

  <!-- Stripe.js -->
  <script src="https://js.stripe.com/v3/"></script>

  <!-- API configuration -->
  <script src="../assets/js/config.js"></script>

  <!-- Tu CSS -->
  <link rel="stylesheet" href="../assets/css/style.css">
</head>

<body>
  <div class="wrapper">
    <div class="background-fixed"></div>

    <header class="fixed-header">
      <div class="logo-container text-center">
        <h5 class="pre-title mt-4">Boletaje de</h5>
        <img src="../assets/img/logo_rojo.png" alt="Museo Casa Kahlo Logo" class="img-fluid brand-logo">
      </div>
      <div class="text-section text-center">
        <p class="subtitle lead">Completa la información para tu visita.</p>
      </div>
    </header>

    <main class="scroll-content">
      <div class="form-container text-center">
        <h5 class="pre-title mt-4" id="tour-data"></h5>
        <div class="progress-bar-container">
          <div class="progress-step active" id="step-1">Paso 1</div>
          <div class="progress-step" id="step-2">Paso 2</div>
          <div class="progress-step" id="step-3">Paso 3</div>
        </div>

        <!-- Calendario inline -->
        <div class="mb-3">
          <form id="ticket-form">
            <!-- Paso 1 -->
            <div class="form-step active" id="step-content-1">
              <div class="step-title text-center mb-4">
                <h4>Selecciona tu fecha de visita</h4>
              </div>

              <!-- Tarjeta del calendario -->
              <div class="ticket-card flex-column align-items-center text-center mb-3">
                <div class="w-100 d-flex justify-content-center mt-2">
                  <div id="calendar"></div>
                </div>
                <div id="fecha-seleccionada-info" class="mt-3 fw-bold text-center"></div>
              </div>

              <!-- Botón -->
              <div class="d-grid mt-4 col-6 mx-auto">
                <button type="button" class="btn btn-danger next-step-btn">Siguiente</button>
              </div>
            </div>


            <!-- Paso 2 -->
            <div class="form-step" id="step-content-2">
              <div class="step-title text-center mb-4">
                <h4>Cantidad y Horario</h4>
              </div>

              <!-- Tarjetas de boletos -->
              <div class="row g-3 justify-content-center">

                <div class="ticket-info text-center">
                  <h5 class="ticket-title">Cantidad de Visitantes</h5>
                </div>
                <!-- General -->
                <div class="col-12">
                  <div class="ticket-card">
                    <div class="ticket-info">
                      <h5 class="ticket-title">Entrada General</h5>
                      <p class="ticket-price">$270.00</p>
                    </div>
                    <div class="ticket-quantity">
                      <button type="button" class="btn-qty minus" data-target="entradaTipoA">-</button>
                      <input type="number" id="entradaTipoA" class="ticket-input" min="0" value="0" readonly>
                      <button type="button" class="btn-qty plus" data-target="entradaTipoA">+</button>
                    </div>
                  </div>
                </div>

                <!-- Mexicano -->
                <div class="col-12">
                  <div class="ticket-card">
                    <div class="ticket-info">
                      <h5 class="ticket-title">Ciudadano Mexicano</h5>
                      <p class="ticket-price">$130.00</p>
                    </div>
                    <div class="ticket-quantity">
                      <button type="button" class="btn-qty minus" data-target="entradaTipoB">-</button>
                      <input type="number" id="entradaTipoB" class="ticket-input" min="0" value="0" readonly>
                      <button type="button" class="btn-qty plus" data-target="entradaTipoB">+</button>
                    </div>
                  </div>
                </div>

                <!-- Especial -->
                <div class="col-12">
                  <div class="ticket-card">
                    <div class="ticket-info">
                      <h5 class="ticket-title">Estudiante / Adulto Mayor / Niño (-12) / Capacidades diferentes</h5>
                      <p class="ticket-price">$65.00</p>
                    </div>
                    <div class="ticket-quantity">
                      <button type="button" class="btn-qty minus" data-target="entradaTipoC">-</button>
                      <input type="number" id="entradaTipoC" class="ticket-input" min="0" value="0" readonly>
                      <button type="button" class="btn-qty plus" data-target="entradaTipoC">+</button>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Selección de horario -->
              <div class="col-12 mt-3">
                <div class="ticket-card horario-card">
                  <div class="ticket-info text-center">
                    <h5 class="ticket-title">Para selecciona un horario</h5>
                    <p class="ticket-price">Primero consulta la disponibilidad</p>
                  </div>

                  <!-- Botón para verificar horarios -->
                  <button type="button" id="btn-ver-horarios" class="btn btn-outline-danger mt-2 mb-3">
                    Consultar Horarios Disponibles
                  </button>

                  <!-- Select de horarios (deshabilitado al inicio) -->
                  <select id="horario" class="form-select ticket-input" disabled>
                    <option value="" selected disabled>-- Elige un horario --</option>
                  </select>
                </div>
              </div>



              <!-- Botones -->
              <div class="d-flex justify-content-between col-12 mt-4">
                <button type="button" class="btn btn-outline-secondary prev-step-btn">← Atrás</button>
                <button type="button" class="btn btn-danger next-step-btn">Siguiente →</button>
              </div>

            </div>

            <!-- Paso 3 -->
            <div class="form-step" id="step-content-3">
              <div class="step-title text-center mb-4">
                <h4>Información de contacto</h4>
              </div>

              <div id="login-section" class="container" style="display: none;">
                <h5 class="pre-title">¿Ya tienes cuenta? Ingresa para continuar.</h5>
                <div class="mb-3">
                  <label for="login-correo" class="form-label">Correo electrónico</label>
                  <input type="email" id="login-correo" class="form-control" placeholder="tu@correo.com">
                </div>
                <div class="mb-3">
                  <label for="login-pass" class="form-label">Contraseña</label>
                  <input type="password" id="login-pass" class="form-control" placeholder="tu contraseña">
                </div>
                <div class="d-flex justify-content-center my-4">
                  <button type="button" class="btn btn-primary" id="btn-ingresar">Ingresar</button>
                </div>
                <hr>
              </div>

              <div id="contact-info-section" class="container">
                <h5 class="pre-title" id="contact-title">Crea tu cuenta para continuar</h5>
                <div class="mb-3">
                  <label for="nombres" class="form-label">Nombres</label>
                  <input type="text" id="nombres" class="form-control" placeholder="Tus nombres">
                </div>
                <div class="mb-3">
                  <label for="apellidos" class="form-label">Apellidos</label>
                  <input type="text" id="apellidos" class="form-control" placeholder="Tus apellidos">
                </div>
                <div class="mb-3">
                  <label for="telefono" class="form-label">Teléfono</label>
                  <input type="tel" id="telefono" class="form-control" placeholder="Teléfono">
                </div>
                <div class="mb-3">
                  <label for="correo" class="form-label">Correo electrónico</label>
                  <input type="email" id="correo" class="form-control" placeholder="Correo">
                </div>
                <div class="mb-3">
                  <label for="password" class="form-label">Contraseña</label>
                  <input type="password" id="password" class="form-control" placeholder="Crea una contraseña">
                </div>
                <div class="mb-3">
                  <label for="repeat-password" class="form-label">Repetir contraseña</label>
                  <input type="password" id="repeat-password" class="form-control" placeholder="Repite la contraseña">
                </div>
              </div>

              <div class="d-flex justify-content-center col-12 mt-4 text-center">
                <button type="button" class="btn btn-primary" id="toggle-auth-btn">Ya tengo cuenta</button>
              </div>

              <div class="d-flex justify-content-between col-12 mt-4">
                <button type="button" class="btn btn-outline-secondary prev-step-btn">← Atrás</button>
                <button type="button" class="btn btn-danger next-step-btn" id="btn-step3-next">Siguiente →</button>
              </div>
            </div>


            <!-- Paso 4: Resumen de compra -->
            <div class="form-step" id="step-content-4">
              <div class="step-title text-center mb-4">
                <h4>Resumen de tu reservación</h4>
              </div>

              <div class="container">
                <div class="row justify-content-center">
                  <div class="col-sm-10">

                    <!-- Tipo de boleto -->
                    <div class="ticket-card mb-3">
                      <div class="ticket-info">
                        <h5 class="ticket-title">Tipo de boleto</h5>
                        <p class="ticket-price"><span id="res-tipo-boleto"></span></p>
                      </div>
                    </div>

                    <!-- Fecha -->
                    <div class="ticket-card mb-3">
                      <div class="ticket-info">
                        <h5 class="ticket-title">Fecha</h5>
                        <p class="ticket-price"><span id="res-fecha"></span></p>
                      </div>
                    </div>

                    <!-- Horario -->
                    <div class="ticket-card mb-3">
                      <div class="ticket-info">
                        <h5 class="ticket-title">Horario</h5>
                        <p class="ticket-price"><span id="res-horario"></span></p>
                      </div>
                    </div>

                    <!-- Número de visitantes -->
                    <div class="ticket-card mb-3">
                      <div class="ticket-info">
                        <h5 class="ticket-title">Número de visitantes</h5>
                        <p class="ticket-price"><span id="res-visitantes"></span></p>
                      </div>
                    </div>

                    <!-- Nombre -->
                    <div class="ticket-card mb-3">
                      <div class="ticket-info">
                        <h5 class="ticket-title">Nombre del responsable</h5>
                        <p class="ticket-price"><span id="res-nombre"></span></p>
                      </div>
                    </div>

                    <!-- Teléfono -->
                    <div class="ticket-card mb-3">
                      <div class="ticket-info">
                        <h5 class="ticket-title">Teléfono</h5>
                        <p class="ticket-price"><span id="res-telefono"></span></p>
                      </div>
                    </div>

                    <!-- Correo -->
                    <div class="ticket-card mb-3">
                      <div class="ticket-info">
                        <h5 class="ticket-title">Correo</h5>
                        <p class="ticket-price"><span id="res-correo"></span></p>
                      </div>
                    </div>

                    <!-- Total -->
                    <div class="ticket-card mb-3 highlight-card">
                      <div class="ticket-info text-center">
                        <h5 class="ticket-title">Total a Pagar</h5>
                        <p class="ticket-price fs-4"><span id="res-total"></span></p>
                      </div>
                    </div>

                    <!-- Datos adicionales -->
                    <div class="ticket-card mb-4 flex-column align-items-start" hidden>
                      <div class="ticket-info w-100">
                        <h5 class="ticket-title">Datos adicionales</h5>
                        <ul id="res-adicionales" class="mb-0"></ul>
                      </div>
                    </div>

                    <!-- Checkboxes de confirmación -->
                    <div class="ticket-card flex-column align-items-start mb-3">
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="check-privacidad">
                        <label class="form-check-label" for="check-privacidad">
                          Acepto el <a href="#" target="_blank">Aviso de Privacidad</a>
                        </label>
                      </div>
                      <div class="form-check mt-2">
                        <input class="form-check-input" type="checkbox" id="check-terminos">
                        <label class="form-check-label" for="check-terminos">
                          Acepto los <a href="#" target="_blank">Términos y Condiciones</a>
                        </label>
                      </div>
                    </div>


                    <!-- Botones -->
                    <div class="d-flex justify-content-between col-12 mt-4">
                      <button type="button" class="btn btn-outline-secondary prev-step-btn">← Atrás</button>
                      <button type="button" class="btn btn-danger" id="btn-pagar">Pagar</button>
                    </div>

                  </div>
                </div>
              </div>
            </div>



          </form>

        </div>

      </div>

    </main>

    <footer class="fixed-footer">
      <div class="footer-content d-flex justify-content-center flex-wrap gap-4">
        <p class="mb-0"><a href="#">Aviso de Privacidad</a></p>
        <p class="mb-0"><a href="#">Términos y Condiciones</a></p>
      </div>
    </footer>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <!-- AOS -->
  <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
  <script>AOS.init();</script>


  <!-- ============================= -->
  <!-- 1. Librerías necesarias -->
  <!-- ============================= -->
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/es.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>



  <!-- ============================= -->
  <!-- 3. Utilidades -->
  <!-- ============================= -->
  <script>
    function getUrlParameter(name) {
      name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
      const regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
      const results = regex.exec(location.search);
      return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
    }
  </script>

  <!-- ============================= -->
  <!-- 4. Calendario -->
  <!-- ============================= -->
  <script>
    let calendarInstance;
    let fechaSeleccionadaGlobal = null;

    function initializeCalendar(fechasNoDisponibles) {
      let disableDates = [];
      if (fechasNoDisponibles) {
        try {
          disableDates = typeof fechasNoDisponibles === "string"
            ? JSON.parse(fechasNoDisponibles)
            : fechasNoDisponibles;
        } catch (e) {
          console.error("Error al parsear fechas no disponibles:", e);
        }
      }

      const calendarConfig = {
        inline: true,
        locale: "es",
        dateFormat: "d/m/Y",
        defaultDate: "today",
        minDate: null,
        disable: [
          // 1. Deshabilitar todos los martes
          function (date) {
            return (date.getDay() === 2); // 2 = Martes
          },
          // 2. Fechas que manda la API
          ...disableDates
        ],
        onChange: function (selectedDates, dateStr) {
          if (selectedDates.length > 0) {
            const fecha = selectedDates[0];
            const diasSemana = ["Domingo", "Lunes", "Martes", "Miércoles", "Jueves", "Viernes", "Sábado"];
            const diaTexto = diasSemana[fecha.getDay()];
            const año = fecha.getFullYear();
            const mes = String(fecha.getMonth() + 1).padStart(2, '0');
            const dia = String(fecha.getDate()).padStart(2, '0');

            fechaSeleccionadaGlobal = {
              date: fecha,
              formatted: dateStr,
              apiFormat: `${año}-${mes}-${dia}`
            };

            document.getElementById("fecha-seleccionada-info").textContent =
              `Seleccionaste: ${diaTexto} ${dateStr}`;

            if (typeof selecciona_horario === "function") {
              selecciona_horario(fecha);
            }
          } else {
            fechaSeleccionadaGlobal = null;
            document.getElementById("fecha-seleccionada-info").textContent = "";
            document.getElementById("horario").innerHTML =
              '<option value="" selected disabled>-- Elige un horario --</option>';
          }
        }
      };

      calendarInstance = flatpickr("#calendar", calendarConfig);
    }

    function selecciona_horario(fecha) {
      const dayselected = (typeof fecha === 'string') ? new Date(fecha.replace(/\//g, '-')) : fecha;
      const diasSemana = ["Domingo", "Lunes", "Martes", "Miercoles", "Jueves", "Viernes", "Sabado"];
      const weekday_text = diasSemana[dayselected.getDay()];

      if (!window._TourSalidas || !Array.isArray(window._TourSalidas)) {
        document.getElementById("horario").innerHTML =
          '<option value="">No hay horarios disponibles</option>';
        return;
      }

      const horariosDelDia = window._TourSalidas.filter(s => s.dia === weekday_text);
      let opciones = `<option value="" selected disabled>-- Elige un horario --</option>`;

      if (horariosDelDia.length > 0) {
        horariosDelDia.forEach(salida => {
          opciones += `<option value="${salida.hora_salida}">${salida.hora_salida}</option>`;
        });
      } else {
        opciones += `<option value="">No hay horarios para este día</option>`;
      }

      document.getElementById("horario").innerHTML = opciones;
    }

    // Botón "Ver Horarios Disponibles"
    document.getElementById("btn-ver-horarios").addEventListener("click", async function () {

      // Obtener cantidades
      const tipoA = parseInt(document.getElementById("entradaTipoA").value) || 0;
      const tipoB = parseInt(document.getElementById("entradaTipoB").value) || 0;
      const tipoC = parseInt(document.getElementById("entradaTipoC").value) || 0;
      const totalVisitantes = tipoA + tipoB + tipoC;

      // Validar visitantes
      if (totalVisitantes === 0 || totalVisitantes > 30) {
        Swal.fire({
          icon: "warning",
          title: "Selecciona visitantes",
          text: "Debes seleccionar entre 1 y 30 visitantes como máximo",
          confirmButtonText: "Entendido",
          confirmButtonColor: "#a01e24"
        });
        return; // Detener flujo
      }

      // Mostrar loading
      Swal.fire({
        title: "Verificando horarios disponibles",
        text: "Espera un momento...",
        allowOutsideClick: false,
        showConfirmButton: false,
        willOpen: () => {
          Swal.showLoading();
        }
      });

      // Obtener tourId y fecha
      const tourId = getUrlParameter('id');
      let fecha = "";
      if (fechaSeleccionadaGlobal && fechaSeleccionadaGlobal.apiFormat) {
        fecha = fechaSeleccionadaGlobal.apiFormat;
      } else {
        fecha = document.getElementById("res-fecha").textContent;
      }

      // Llamada a la API de horarios
      try {
        const response = await axios.get(`${API_BASE_URL}/venta/horarios/${tourId}/fecha/${fecha}/boletos/${totalVisitantes}`);
        Swal.close(); // Cierra el loading
        const horarioSelect = document.getElementById("horario");
        horarioSelect.removeAttribute("disabled");

        let opciones = `<option value="" selected disabled>-- Elige un horario --</option>`;
        let todosNoDisponibles = true;
        if (response.data && Array.isArray(response.data.horarios)) {
          response.data.horarios.forEach(horario => {
            if (horario.disponible) {
              opciones += `<option value="${horario.hora_salida}">${horario.hora_salida}</option>`;
              todosNoDisponibles = false;
            } else {
              opciones += `<option value="${horario.hora_salida}" disabled>${horario.hora_salida} (${horario.lugares_disp} lugares disponibles)</option>`;
            }
          });
          if (todosNoDisponibles) {
            opciones += `<option value="">No hay horarios disponibles</option>`;
            horarioSelect.innerHTML = opciones;
            Swal.fire({
              icon: "warning",
              title: "Sin horarios disponibles",
              text: "No hay horarios disponibles para la cantidad de boletos seleccionada.",
              timer: 2500,
              showConfirmButton: false
            });
            return;
          }
        } else {
          opciones += `<option value="">No hay horarios disponibles</option>`;
        }
        horarioSelect.innerHTML = opciones;

        // Aviso de éxito
        Swal.fire({
          icon: "success",
          title: "Horarios disponibles",
          text: "Ya puedes elegir tu horario",
          timer: 1500,
          showConfirmButton: false
        });
      } catch (error) {
        Swal.close();
        Swal.fire({
          icon: "error",
          title: "Error al consultar horarios",
          text: error.message || "No se pudieron obtener los horarios disponibles."
        });
      }
    });


  </script>

  <!-- ============================= -->
  <!-- 5. API: Obtener datos del tour -->
  <!-- ============================= -->
  <script>
    async function getTourData() {
      try {
        document.getElementById('tour-data').textContent = 'Cargando información...';
        const tourId = getUrlParameter('id');
        if (!tourId) throw new Error("ID de experiencia no especificado");

        const response = await axios.get(`${API_BASE_URL}/admin/tour/obtener/${tourId}`);
        if (response.status === 200 && response.data?.tour?.length > 0) {
          const tourData = response.data.tour[0];
          window.tourName = tourData.nombre;
          window.tourPrice = parseFloat(tourData.precio_pp);
          window.descripcionCorta = tourData.descripcion_corta || "";
          window._TourSalidas = Array.isArray(response.data.fechas) ? response.data.fechas : [];

          document.getElementById('tour-data').textContent =
            `Boleto: ${tourData.nombre} / Precio: $${tourData.precio_pp} MNX`;

          updateTotalPrice();
          updateAdditionalInfo(tourData);
          initializeCalendar(tourData.fechas_no_disponibles);
        }
      } catch (error) {
        console.error("Error al obtener datos del tour:", error);
        Swal.fire({
          icon: "error",
          title: "Error de conexión",
          text: "No pudimos cargar la información. Intenta nuevamente."
        }).then(() => window.location.reload());
        initializeCalendar([]);
      }
    }

    function updateAdditionalInfo(tourData) {
      if (tourData.recomendaciones) {
        const li = document.createElement("li");
        li.className = "list-group-item";
        li.innerHTML = `<strong>Recomendaciones:</strong> ${tourData.recomendaciones}`;
        const container = document.querySelector(".list-group");
        if (container) container.appendChild(li);
      }
    }

    function updateTotalPrice() {
      if (window.tourPrice) {
        const tipoA = parseInt(document.getElementById('entradaTipoA').value);
        const tipoB = parseInt(document.getElementById('entradaTipoB').value);
        const tipoC = parseInt(document.getElementById('entradaTipoC').value);

        const total = (270 * tipoA) + (130 * tipoB) + (65 * tipoC);
        const resTotal = document.getElementById('res-total');
        if (resTotal) resTotal.textContent = ` $${total.toLocaleString('es-MX')} MXN`;
      }
    }
  </script>

  <!-- ============================= -->
  <!-- 6. Resumen -->
  <!-- ============================= -->
  <script>
    function updateResumen() {
      console.log("Actualizando resumen...");
      const fecha = fechaSeleccionadaGlobal?.formatted || "";
      const horario = document.getElementById("horario").value || "";

      const tipoA = parseInt(document.getElementById('entradaTipoA').value) || 0;
      const tipoB = parseInt(document.getElementById('entradaTipoB').value) || 0;
      const tipoC = parseInt(document.getElementById('entradaTipoC').value) || 0;

      const nombres = document.getElementById("nombres").value || "";
      const apellidos = document.getElementById("apellidos").value || "";
      const telefono = document.getElementById("telefono").value || "";
      const correo = document.getElementById("correo").value || "";

      const adicionales = [];
      if (document.getElementById("extranjero")?.checked) adicionales.push("Extranjero");
      if (document.getElementById("mayor65")?.checked) adicionales.push("Mayor de 65 años");
      if (document.getElementById("asistencia")?.checked) adicionales.push("Requiere asistencia");

      // Asegurarnos que todos los elementos existen antes de intentar actualizar
      const resTipoBoleto = document.getElementById("res-tipo-boleto");
      const resFecha = document.getElementById("res-fecha");
      const resHorario = document.getElementById("res-horario");

      if (resTipoBoleto) resTipoBoleto.textContent =
        (window.tourName || "Boleto con Guía") + (window.descripcionCorta ? " " + window.descripcionCorta : "");
      if (resFecha) resFecha.textContent = fecha;
      if (resHorario) resHorario.textContent = horario;

      // Calcular detalle de boletos
      const detallesBoletos = [];
      if (tipoA > 0) detallesBoletos.push(`${tipoA} General`);
      if (tipoB > 0) detallesBoletos.push(`${tipoB} Mexicano`);
      if (tipoC > 0) detallesBoletos.push(`${tipoC} Especial`);

      const totalVisitantes = tipoA + tipoB + tipoC;
      let visitantesTexto = `${totalVisitantes} visitante${totalVisitantes !== 1 ? 's' : ''}`;

      if (detallesBoletos.length > 0) {
        visitantesTexto += ` (${detallesBoletos.join(', ')})`;
      }

      const resVisitantes = document.getElementById("res-visitantes");
      if (resVisitantes) resVisitantes.textContent = visitantesTexto;


      const resNombre = document.getElementById("res-nombre");
      const resTelefono = document.getElementById("res-telefono");
      const resCorreo = document.getElementById("res-correo");
      const resAdicionales = document.getElementById("res-adicionales");

      if (resNombre) resNombre.textContent = `${nombres} ${apellidos}`.trim();
      if (resTelefono) resTelefono.textContent = telefono;
      if (resCorreo) resCorreo.textContent = correo;
      if (resAdicionales) resAdicionales.textContent = adicionales.length > 0 ? adicionales.join(", ") : "Ninguno";

      // Actualizar también el total
      const resTotal = document.getElementById("res-total");
      if (resTotal) {
        const total = (270 * tipoA) + (130 * tipoB) + (65 * tipoC);
        resTotal.textContent = ` $${total.toLocaleString('es-MX')} MXN`;
      }

      console.log("Resumen actualizado correctamente");
    }
  </script>

  <!-- ============================= -->
  <!-- 7. Steps del formulario -->
  <!-- ============================= -->
  <script>
    const nextBtns = document.querySelectorAll(".next-step-btn:not(#btn-step3-next)");
    const prevBtns = document.querySelectorAll(".prev-step-btn");
    const formSteps = document.querySelectorAll(".form-step");
    const progressSteps = document.querySelectorAll(".progress-step");
    let currentStep = 0;

    function updateFormSteps() {
      formSteps.forEach((s, i) => s.classList.toggle("active", i === currentStep));
      progressSteps.forEach((s, i) => s.classList.toggle("active", i <= currentStep));
    }

    nextBtns.forEach(btn => {
      btn.addEventListener("click", () => {
        let isValid = true;

        // Paso 1: fecha
        if (currentStep === 0 && !fechaSeleccionadaGlobal) {
          Swal.fire({
            icon: 'warning',
            title: 'Campo requerido',
            text: 'Selecciona una fecha'
          });
          isValid = false;

        } else if (currentStep === 1 && document.getElementById("entradaTipoA").value == 0 && document.getElementById("entradaTipoB").value == 0 && document.getElementById("entradaTipoC").value == 0) {
          Swal.fire({
            icon: 'warning',
            title: 'Campo requerido',
            text: 'Selecciona un tipo de entrada'
          });
          isValid = false;

          // Paso 2: horario
        } else if (currentStep === 1 && !document.getElementById("horario").value) {
          Swal.fire({
            icon: 'warning',
            title: 'Campo requerido',
            text: 'Selecciona un horario'
          });
          isValid = false;

          // Paso 3: información de contacto
        } else if (currentStep === 2) {
          const nombres = document.getElementById("nombres").value.trim();
          const apellidos = document.getElementById("apellidos").value.trim();
          const telefono = document.getElementById("telefono").value.trim();
          const correo = document.getElementById("correo").value.trim();

          if (!nombres || !apellidos || !telefono || !correo) {
            Swal.fire({
              icon: 'warning',
              title: 'Campos requeridos',
              text: 'Completa nombres, apellidos, teléfono y correo'
            });
            isValid = false;
          }
        }

        if (isValid) {
          currentStep++;
          // Si vamos al Step 4 (resumen)
          if (currentStep === 3) updateResumen();
          updateFormSteps();
        }
      });
    });


    prevBtns.forEach(btn => {
      btn.addEventListener("click", () => {
        if (currentStep > 0) {
          currentStep--;
          updateFormSteps();
        }
      });
    });

    updateFormSteps();
  </script>

  <script>
    // Controles de cantidad con + y -
    document.querySelectorAll(".btn-qty").forEach(btn => {
      btn.addEventListener("click", function () {
        const targetId = this.getAttribute("data-target");
        const input = document.getElementById(targetId);
        let value = parseInt(input.value) || 0;
        if (this.classList.contains("plus")) {
          input.value = value + 1;
        } else if (this.classList.contains("minus") && value > 0) {
          input.value = value - 1;
        }
        updateTotalPrice();
      });
    });

  </script>

  <!-- ============================= -->
  <!-- 8. API: Usuario -->
  <!-- ============================= -->
  <script>
    async function getUserData() {
      const _usertoken = localStorage.getItem("usertoken");
      if (!_usertoken) return;
      try {
        const res = await axios.post(`${API_BASE_URL}/usuario/verificar`, {}, {
          headers: { "x-auth-token": _usertoken }
        });
        if (res.data?.[0]?.isClient == 1) {
          document.getElementById("nombre").value =
            res.data[0].nombres + " " + res.data[0].apellidos;
          document.getElementById("telefono").value = res.data[0].telefono;
          document.getElementById("correo").value = res.data[0].correo;
        }
      } catch (err) {
        console.warn("Error al obtener usuario:", err);
      }
    }
  </script>

  <!-- ============================= -->
  <!-- 9. API: Procesar pago -->
  <!-- ============================= -->
  <script>




    document.getElementById("btn-pagar").addEventListener("click", function () {
      const btn = this;
      btn.disabled = true; // deshabilita el botón

      // Opcional: cambiar texto mientras procesa
      btn.textContent = "Procesando...";

      // ejecutar la función
      procesarPago().finally(() => {
        // si quieres volver a habilitarlo después:
        btn.disabled = false;
        btn.textContent = "Pagar";
      });
    });

    async function procesarPago() {
      try {
        // ✅ Validar checkboxes antes de todo
        const checkPriv = document.getElementById("check-privacidad")?.checked;
        const checkTerm = document.getElementById("check-terminos")?.checked;

        if (!checkPriv || !checkTerm) {
          Swal.fire({
            icon: "warning",
            title: "Debes aceptar los términos",
            text: "Por favor acepta el Aviso de Privacidad y los Términos y Condiciones para continuar.",
            confirmButtonText: "Entendido",
            confirmButtonColor: "#a01e24"
          });
          return;
        }


        // Recolectar datos del formulario
        const tourId = getUrlParameter('id');
        const fecha = fechaSeleccionadaGlobal?.apiFormat || document.getElementById('res-fecha').textContent;
        const horario = document.getElementById('res-horario').textContent;

        const tipoA = parseInt(document.getElementById('entradaTipoA').value) || 0;
        const tipoB = parseInt(document.getElementById('entradaTipoB').value) || 0;
        const tipoC = parseInt(document.getElementById('entradaTipoC').value) || 0;

        const tipos_boletos = JSON.stringify({ tipoA, tipoB, tipoC });
        const visitantes = (tipoA + tipoB + tipoC);
        const totalCalculado = (270 * tipoA) + (130 * tipoB) + (65 * tipoC);

        const nombre = document.getElementById('res-nombre').textContent;
        const telefono = document.getElementById('res-telefono').textContent;
        const correo = document.getElementById('res-correo').textContent;

        // Validar datos requeridos
        if (!fecha || !horario || !nombre || !correo || (tipoA + tipoB + tipoC) === 0) {
          Swal.fire({
            icon: "warning",
            title: "Datos incompletos",
            text: "Faltan datos requeridos para procesar el pago"
          });
          return;
        }

        // Obtener ID del cliente (si está logueado)
        let _idCliente = 1;
        const _usertoken = localStorage.getItem("usertoken");
        if (_usertoken) {
          try {
            const userResponse = await axios.post(`${API_BASE_URL}/usuario/verificar`, {}, {
              headers: { "x-auth-token": _usertoken }
            });
            if (userResponse.data && userResponse.data[0]) {
              _idCliente = userResponse.data[0].id;
            }
          } catch (err) {
            console.warn('No se pudo verificar el usuario:', err);
          }
        }




        console.log('Preparando datos para pago:', {
          tourId,
          fecha,
          horario,
          visitantes,
          nombre: nombre,
          correo: correo,
          telefono: telefono,
          total: totalCalculado,
          cliente_id: _idCliente
        });



        // Realizar la solicitud de creación de venta con la API (igual que en compra.html)
        //no_boletos, tipos_boletos, pagado, nombre_cliente, cliente_id, correo, viajeTourId, tourId, fecha_ida, horaCompleta, total
        const response = await axios({
          method: "post",
          url: API_BASE_URL + "/venta/crear",
          data: {
            "no_boletos": parseInt(visitantes),
            "tipos_boletos": tipos_boletos,
            "pagado": 1,
            "comision": 2.3,
            "status_traspaso": 1,
            "nombre_cliente": nombre,
            "cliente_id": _idCliente,
            "correo": correo,
            "tourId": tourId,
            "fecha_ida": fecha,
            "horaCompleta": horario,
            "total": totalCalculado
          }
        });

        console.log('Respuesta de la API:', response.data);

        if (response.data && response.data.id_reservacion) {
          Swal.fire({
            title: "Transacción aprobada",
            text: "Id Reservacion: " + response.data.id_reservacion + "\n",
            icon: "success",
            confirmButtonText: "Ok",
          }).then((result) => {
            if (result.isConfirmed) {
              window.location.href = "https://museodesarrollo.info";
            }
          });


        } else {
          throw new Error('No se recibió un ID de reservación válido');
        }



      } catch (error) {
        console.error('Error al procesar el pago:', error);
        Swal.fire({
          icon: "error",
          title: "Error",
          text: "Error al procesar el pago. Por favor, intenta nuevamente."
        });
      }
    }
  </script>


  <!-- ============================= -->
  <!-- ingresar -->
  <!-- ============================= -->
  <script>
    // ====================================================================
    // 10. Lógica de Verificación de Usuario
    // ====================================================================

    document.addEventListener("DOMContentLoaded", function () {
      const toggleAuthBtn = document.getElementById("toggle-auth-btn");
      const loginSection = document.getElementById("login-section");
      const contactInfoSection = document.getElementById("contact-info-section");
      const contactTitle = document.getElementById("contact-title");
      const btnIngresar = document.getElementById("btn-ingresar");
      const btnNextStep3 = document.getElementById("btn-step3-next");

      const nombresInput = document.getElementById("nombres");
      const apellidosInput = document.getElementById("apellidos");
      const telefonoInput = document.getElementById("telefono");
      const correoInput = document.getElementById("correo");
      const passwordInput = document.getElementById("password");
      const repeatPasswordInput = document.getElementById("repeat-password");

      // Función para habilitar o deshabilitar los campos de contacto y contraseña
      function setContactFieldsEnabled(enabled) {
        nombresInput.disabled = !enabled;
        apellidosInput.disabled = !enabled;
        telefonoInput.disabled = !enabled;
        correoInput.disabled = !enabled;
        passwordInput.disabled = !enabled;
        repeatPasswordInput.disabled = !enabled;
        btnNextStep3.disabled = !enabled;
      }

      // Ocultar la sección de login al cargar la página
      loginSection.style.display = "none";
      setContactFieldsEnabled(true);

      // Función para alternar entre "Iniciar Sesión" y "Crear Cuenta"
      toggleAuthBtn.addEventListener("click", () => {
        // Alternar visibilidad de las secciones
        const isLoginVisible = loginSection.style.display === "block";
        loginSection.style.display = isLoginVisible ? "none" : "block";
        contactInfoSection.style.display = isLoginVisible ? "block" : "none";

        // Alternar texto del botón y estado de los campos
        if (isLoginVisible) {
          toggleAuthBtn.textContent = "Ingresar a cuenta";
          setContactFieldsEnabled(true);
          nombresInput.value = "";
          apellidosInput.value = "";
          telefonoInput.value = "";
          correoInput.value = "";
          passwordInput.value = "";
          repeatPasswordInput.value = "";
        } else {
          toggleAuthBtn.textContent = "Crear cuenta";
          setContactFieldsEnabled(false);
          // Si pasamos a la sección de login, se desactivan los campos del formulario
        }
      });

      // Evento para el botón "Ingresar" (login real)
      btnIngresar.addEventListener("click", async function () {
        const correoLogin = document.getElementById("login-correo").value.trim();
        const passwordLogin = document.getElementById("login-pass").value;
        if (!correoLogin || !passwordLogin) {
          Swal.fire({
            icon: 'warning',
            title: 'Campos requeridos',
            text: 'Ingresa tu correo y contraseña para iniciar sesión.'
          });
          return;
        }
        Swal.fire({
          title: "Verificando...",
          text: "Iniciando sesión",
          allowOutsideClick: false,
          showConfirmButton: false,
          willOpen: () => { Swal.showLoading(); }
        });
        try {
          const res = await axios.post(`${API_BASE_URL}/usuario/login`, {
            email: correoLogin,
            password: passwordLogin
          });
          Swal.close();
          if (res.status === 200 && res.data.error === false && res.data.token) {
            console.log("✅ LOGIN EXITOSO - Token recibido:", res.data.token);
            localStorage.setItem('usertoken', res.data.token);

            // Obtener datos del usuario
            try {
              const userRes = await axios.post(`${API_BASE_URL}/usuario/verificar`, {}, {
                headers: { "x-auth-token": res.data.token }
              });
              if (userRes.data && userRes.data[0]) {
                nombresInput.value = userRes.data[0].nombres || "";
                apellidosInput.value = userRes.data[0].apellidos || "";
                telefonoInput.value = userRes.data[0].telefono || "";
                correoInput.value = userRes.data[0].correo || "";
                console.log("Datos del usuario cargados:", {
                  nombres: nombresInput.value,
                  apellidos: apellidosInput.value,
                  telefono: telefonoInput.value,
                  correo: correoInput.value
                });
              }
            } catch (userError) {
              console.warn("No se pudieron cargar los datos del usuario:", userError);
            }

            // Ocultar la sección de login y mostrar la de contacto
            loginSection.style.display = "none";
            contactInfoSection.style.display = "block";
            toggleAuthBtn.textContent = "Ingresar a cuenta";
            btnNextStep3.disabled = false;

            // AVANZAR AUTOMÁTICAMENTE AL RESUMEN después del login exitoso
            Swal.fire({
              icon: 'success',
              title: 'Login exitoso',
              text: 'Bienvenido! Preparando tu resumen de reserva...',
              allowOutsideClick: false,
              showConfirmButton: false,
              timer: 2000,
              willOpen: () => { Swal.showLoading(); }
            }).then(() => {
              // Ejecutar la misma lógica que el botón "Siguiente" para usuarios autenticados
              console.log("🚀 Avanzando automáticamente al resumen después del login");
              updateResumen();
              formSteps.forEach(step => step.classList.remove("active"));
              if (formSteps[3]) {
                formSteps[3].classList.add("active");
                console.log("📄 Mostrando resumen automáticamente después del login");
              }

              progressSteps.forEach((s, i) => {
                if (i <= 2) s.classList.add("active");
                else s.classList.remove("active");
              });

              currentStep = 3;
            });
          } else {
            console.error("❌ LOGIN FALLÓ - Respuesta de API:", res.data);
            Swal.fire({
              icon: 'error',
              title: 'Error al iniciar sesión',
              text: res.data.msg || 'No se pudo iniciar sesión.'
            });
          }
        } catch (err) {
          Swal.close();
          console.error("❌ LOGIN FALLÓ - Error de conexión:", err);
          Swal.fire({
            icon: 'error',
            title: 'Error de conexión',
            text: err.response?.data?.msg || err.message || 'No se pudo iniciar sesión.'
          });
        }
      });
    });

    // ============================= //
    // Event listener para botón "Siguiente" del paso 3
    // ============================= //
    (function () {
      const btnNextStep3 = document.getElementById("btn-step3-next");
      const contactInfoSection = document.getElementById("contact-info-section");
      const loginSection = document.getElementById("login-section"); // Asegurarse de que esta variable está definida
      const nombresInput = document.getElementById("nombres");
      const apellidosInput = document.getElementById("apellidos");
      const telefonoInput = document.getElementById("telefono");
      const correoInput = document.getElementById("correo");
      const passwordInput = document.getElementById("password");
      const repeatPasswordInput = document.getElementById("repeat-password");

      console.log("Secciones importantes:", {
        contactInfoSection: contactInfoSection ? true : false,
        loginSection: loginSection ? true : false,
        btnNextStep3: btnNextStep3 ? true : false
      });

      if (loginSection) {
        console.log("Estado inicial loginSection:", loginSection.style.display || "sin valor");
      } else {
        console.error("loginSection no encontrada - esto afectará la condición de registro");
      }

      if (btnNextStep3) {
        btnNextStep3.addEventListener("click", async function (e) {
          e.preventDefault();
          console.log("=== CLICK EN BOTÓN SIGUIENTE DEL PASO 3 ===");

          // Verificar si hay un token de usuario (SIEMPRE verificar en tiempo real)
          const hasUserToken = localStorage.getItem("usertoken");
          console.log("Token de usuario encontrado:", !!hasUserToken);

          // Obtener valores de campos independientemente del modo
          const nombres = nombresInput.value.trim();
          const apellidos = apellidosInput.value.trim();
          const telefono = telefonoInput.value.trim();
          const correo = correoInput.value.trim();
          const password = passwordInput?.value || '';
          const repeatPassword = repeatPasswordInput?.value || '';

          console.log("=== VALORES DE CAMPOS ===", {
            nombres: nombres,
            apellidos: apellidos,
            telefono: telefono,
            correo: correo,
            password: password ? `[${password.length} chars]` : 'vacio',
            repeatPassword: repeatPassword ? `[${repeatPassword.length} chars]` : 'vacio',
            hasUserToken: !!hasUserToken
          });

          // DETECCIÓN SIMPLE: Si hay contraseña, es registro
          const isRegistering = password && password.length > 0 && repeatPassword && repeatPassword.length > 0;

          console.log("=== DETECCIÓN DE FLUJO ===", {
            isRegistering: isRegistering,
            passwordLength: password.length,
            repeatPasswordLength: repeatPassword.length
          });

          // VALIDAR CAMPOS BÁSICOS
          if (!nombres || !apellidos || !telefono || !correo) {
            Swal.fire({
              icon: 'warning',
              title: 'Atención',
              text: 'Debes ingresar a tu cuenta o regístrate para continuar'
            });
            return;
          }

          // FLUJO 1: REGISTRO (tiene contraseñas)
          if (isRegistering) {
            console.log("🎯 DETECTADO: FLUJO DE REGISTRO");

            // Validar contraseñas
            if (password.length < 6) {
              Swal.fire({
                icon: 'warning',
                title: 'Contraseña muy corta',
                text: 'La contraseña debe tener al menos 6 caracteres.'
              });
              return;
            }

            if (password !== repeatPassword) {
              Swal.fire({
                icon: 'error',
                title: 'Contraseñas no coinciden',
                text: 'Verifica que ambas contraseñas sean iguales.'
              });
              return;
            }

            // EJECUTAR REGISTRO
            console.log("🚀 INICIANDO REGISTRO DE USUARIO");

            Swal.fire({
              title: 'Registrando usuario...',
              text: 'Creando tu cuenta, por favor espera...',
              allowOutsideClick: false,
              showConfirmButton: false,
              willOpen: () => { Swal.showLoading(); }
            });

            try {
              // Preparar datos para la API
              const datosRegistro = {
                nombres: nombres,
                apellidos: apellidos,
                telefono: telefono,
                correo: correo,
                password: password
              };

              console.log("📤 ENVIANDO A API:", {
                url: `${API_BASE_URL}/usuario/crear`,
                datos: { ...datosRegistro, password: '[OCULTO]' }
              });

              const response = await axios.post(`${API_BASE_URL}/usuario/crear`, datosRegistro, {
                timeout: 15000
              });

              console.log("📥 RESPUESTA DE API:", response);

              if (response.status === 200 && response.data && response.data.error === false) {
                console.log("✅ REGISTRO EXITOSO");

                // Guardar token si viene
                if (response.data.token) {
                  localStorage.setItem("usertoken", response.data.token);
                  console.log("🔑 Token guardado:", response.data.token);
                }

                Swal.close();

                Swal.fire({
                  icon: 'success',
                  title: 'Registro exitoso',
                  text: 'Tu cuenta ha sido creada correctamente.',
                  confirmButtonText: 'Continuar'
                }).then(() => {
                  // Deshabilitar campos
                  nombresInput.disabled = true;
                  apellidosInput.disabled = true;
                  telefonoInput.disabled = true;
                  correoInput.disabled = true;
                  passwordInput.disabled = true;
                  repeatPasswordInput.disabled = true;

                  // Ir al resumen
                  updateResumen();
                  formSteps.forEach(step => step.classList.remove("active"));
                  if (formSteps[3]) {
                    formSteps[3].classList.add("active");
                    console.log("📄 Mostrando resumen después de registro");
                  }

                  progressSteps.forEach((s, i) => {
                    if (i <= 2) s.classList.add("active");
                    else s.classList.remove("active");
                  });

                  currentStep = 3;
                });

              } else {
                console.log("❌ ERROR EN REGISTRO:", response.data);
                Swal.close();

                let errorMsg = "No se pudo crear la cuenta.";
                if (response.data && response.data.msg) {
                  errorMsg = response.data.msg;
                }

                Swal.fire({
                  icon: 'error',
                  title: 'Error en el registro',
                  text: errorMsg
                });
              }

            } catch (error) {
              console.log("💥 ERROR DE CONEXIÓN:", error);
              Swal.close();

              let errorMsg = 'Error de conexión. Verifica tu internet.';
              if (error.response && error.response.data && error.response.data.msg) {
                errorMsg = error.response.data.msg;
              }

              Swal.fire({
                icon: 'error',
                title: 'Error de conexión',
                text: errorMsg
              });
            }

            return; // Salir después del flujo de registro
          }

          // FLUJO 2: USUARIO YA LOGUEADO (tiene token pero no contraseñas)
          if (hasUserToken && !isRegistering) {
            console.log("🎯 DETECTADO: USUARIO YA AUTENTICADO");

            Swal.fire({
              title: 'Preparando resumen...',
              text: 'Cargando datos de tu reserva...',
              allowOutsideClick: false,
              showConfirmButton: false,
              timer: 1500,
              willOpen: () => { Swal.showLoading(); }
            }).then(() => {
              updateResumen();
              formSteps.forEach(step => step.classList.remove("active"));
              if (formSteps[3]) {
                formSteps[3].classList.add("active");
                console.log("📄 Mostrando resumen para usuario autenticado");
              }

              progressSteps.forEach((s, i) => {
                if (i <= 2) s.classList.add("active");
                else s.classList.remove("active");
              });

              currentStep = 3;
            });

            return;
          }

          // FLUJO 3: SIN AUTENTICACIÓN (no tiene token ni contraseñas)
          console.log("🎯 DETECTADO: SIN AUTENTICACIÓN");
          Swal.fire({
            icon: 'warning',
            title: 'Autenticación requerida',
            text: 'Debes registrarte (llenar contraseñas) o iniciar sesión antes de continuar.',
            confirmButtonText: 'Entendido'
          });
        });
      }
    })(); // Ejecutar inmediatamente
  </script>


  <!-- ============================= -->
  <!-- 10. Inicialización y lógica de login/signin -->
  <!-- ============================= -->
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const tipoAInput = document.getElementById('entradaTipoA');
      const tipoBInput = document.getElementById('entradaTipoB');
      const tipoCInput = document.getElementById('entradaTipoC');

      if (tipoAInput) tipoAInput.addEventListener('change', updateTotalPrice);
      if (tipoBInput) tipoBInput.addEventListener('change', updateTotalPrice);
      if (tipoCInput) tipoCInput.addEventListener('change', updateTotalPrice);

      getTourData();
      getUserData();

      
      
      // --- Lógica de login ---
      const btnLogin = document.getElementById('btn-login');
      if (btnLogin) {
        btnLogin.addEventListener('click', async function (e) {
          e.preventDefault();
          const email = document.getElementById('login-email').value;
          const password = document.getElementById('login-password').value;
          try {
            const res = await axios.post(API_BASE_URL + '/usuario/login', { email, password });
            if (res.status === 200 && res.data.error === false) {
              localStorage.setItem('usertoken', res.data.token);
              Swal.fire({
                title: 'Felicidades!',
                text: 'Has hecho login satisfactoriamente',
                icon: 'success',
                confirmButtonText: 'Ok'
              }).then(() => {
                // Oculta sección login y muestra datos de usuario
                document.getElementById('login-section').style.display = 'none';
                document.getElementById('user-data-section').style.display = 'block';
              });
            } else {
              Swal.fire({
                title: 'Atención!',
                text: res.data.msg || 'Error al iniciar sesión',
                icon: 'error',
                confirmButtonText: 'Ok'
              });
            }
          } catch (err) {
            Swal.fire({
              title: 'Atención!',
              text: err.response?.data?.msg || 'Error de conexión',
              icon: 'error',
              confirmButtonText: 'Ok'
            });
          }
        });
      }

      // --- Lógica de registro ---
      const btnSignin = document.getElementById('btn-signin');
      if (btnSignin) {
        btnSignin.addEventListener('click', async function (e) {
          e.preventDefault();
          const nombres = document.getElementById('signin-nombres').value;
          const apellidos = document.getElementById('signin-apellidos').value;
          const telefono = document.getElementById('signin-telefono').value;
          const email = document.getElementById('signin-email').value;
          const password1 = document.getElementById('signin-password1').value;
          const password2 = document.getElementById('signin-password2').value;
          if (password1 !== password2) {
            Swal.fire({
              title: 'Atención!',
              text: 'Tus contraseñas no coinciden, inténtalo nuevamente',
              icon: 'error',
              confirmButtonText: 'Ok'
            });
            return;
          }
          try {
            const res = await axios.post(API_BASE_URL + '/usuario/crear', {
              nombres,
              apellidos,
              telefono,
              correo: email,
              password: password1
            });
            if (res.status === 200 && res.data.error === false) {
              Swal.fire({
                title: 'Felicidades!',
                text: 'Se han registrado tus datos existosamente',
                icon: 'success',
                confirmButtonText: 'Ok'
              }).then(() => {
                // Oculta registro y muestra login
                document.getElementById('signin-section').style.display = 'none';
                document.getElementById('login-section').style.display = 'block';
              });
            } else {
              Swal.fire({
                title: 'Atención!',
                text: res.data.msg || 'Error al registrar',
                icon: 'error',
                confirmButtonText: 'Ok'
              });
            }
          } catch (err) {
            Swal.fire({
              title: 'Atención!',
              text: err.response?.data?.msg || 'Error de conexión',
              icon: 'error',
              confirmButtonText: 'Ok'
            });
          }
        });
      }
    });
  </script>


</body>

</html>